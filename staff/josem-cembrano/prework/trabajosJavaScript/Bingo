/*
BINGO GAME! ðŸŽ²ðŸŽ°
Realiza un programa que simule un Bingo. Cuando se ejecute, pedirÃ¡ el nombre del jugador y deberÃ¡ guardarse. Durante el primer turno se mostrarÃ¡ un cartÃ³n con 15 nÃºmeros (excluyendo el 0 siempre), 
para pasar al siguiente turno el usuario deberÃ¡ confirmar mediante confirm() visualizÃ¡ndose otro nÃºmero, si coincide con alguno de los existentes en el cartÃ³n, 
cambiarÃ¡ por una "X" o un 0. El cartÃ³n se mostrarÃ¡, al final de cada turno, con los cambios efectuados, indicÃ¡ndole al usuario quÃ© nÃºmero se ha encontrado. 
El programa deberÃ¡ preguntar al usuario al inicio de cada turno si desea continuar, en caso de que se continÃºe, seguirÃ¡ el mismo patrÃ³n que hasta el momento.

Por supuesto, cuando todos los nÃºmeros de una misma linea estÃ©n en "X", mostrarÃ¡ una Ãºnica vez el mensaje "LINEA!", pero la ejecuciÃ³n seguirÃ¡, el juego solo acabarÃ¡ cuando todos los nÃºmeros estÃ©n a "X".

Cuando el juego concluya, deberÃ¡ decirle al usuario en cuantos turnos se ha completado el cartÃ³n. Por Ãºltimo, deberÃ¡ preguntar si desea volver a jugar.

Empieza por la versiÃ³n mÃ¡s bÃ¡sica! (No se entrega)
Why?
Comenzar por una versiÃ³n muy pequeÃ±a y bÃ¡sica nos harÃ¡ tener un programa de principio a fin, es decir, que empieza, que acaba y haga lo que queramos a muy pequeÃ±a escala, 
una vez lo tengamos todo bien dividido podremos empezar a extenderlo tanto como queramos.

Si funciona con 5 nÃºmeros deberÃ¡ funcionar con 15, no? ðŸ˜

Requisitos de la versiÃ³n mÃ­nima:
CartÃ³n con solo 5 nÃºmeros, sin necesidad de ser generados random. Solo necesitamos un nÃºmero random cuando recorramos el cartÃ³n y veamos si hay alguna coincidencia. 
No necesitamos asegurarnos que el nÃºmero random de cada turno no haya salido en turnos anteriores, recuerda que estamos en la mÃ­nima versiÃ³n posible, eso ya lo solucionaremos. 
Si hay coincidencia, remplazaremos el nÃºmero por una 'x' y mostramos el cartÃ³n modificado

SepÃ¡ralo todo en funciones, englobado en una funciÃ³n global llamada bingo(), tal que:

-Function! => Generar Numero Random Bombo

-Function! => Nuevo turno (Match carton[i] === randomNum)

-Function! => Preguntar Nuevo Turno 



Pro ðŸ‘ŠðŸ¼

Cuando se muestre la carta, se preguntarÃ¡ al usuario si realmente quiere ese cartÃ³n o generar otro, si realmente quiere ese cartÃ³n, deberÃ¡ responder "yes" para proceder.
Los nÃºmeros del cartÃ³n deben aparecer de una forma amigable y ordenados de menor a mayor.
Los nÃºmeros del cartÃ³n no se pueden repetir.
Establece un sistema de puntos, en cuantos mÃ¡s turnos se complete el cartÃ³n, menos puntos (el sistema de puntos intÃ©gralo como quieras), por el contrario, a menos turnos, mÃ¡s puntos.
Antes de empezar el juego, muestra el sistema de puntos al usuario.
Ranking de usuarios (ordenado por puntos).*/

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


let user = "";
let changeCardBoard = 0;
const infoNumberCardBoard = 5;
let userBalls = 0;
const min = 1;
const max = 50;
const noRepeatNumbers = [];
let line = "";
const saveNumbers = [];
let anotherRandomNumber = 0;
let points = 100;
let fail = points - 1;
let userPoints = 0;
const noRepeatBall = [];
let lineCount = 0;
let ranking = [];
const completedLines = [0, 0, 0];

const welcome = () => {//BIENVENIDA AL USUARIO
    user = prompt(`Bienvenido al ðŸŽ²BINGO ISDI CODERS!!ðŸŽ²\nCUAL VA A SER SU NOMBRE EN EL JUEGO??`);
    if (user === "") {
        alert(`Introduzca un nombre correctamente.`);
        welcome();
    } else if (user === null) {
        alert(`Hasta pronto desconocido...`);
        return;
    } else {
        alert(`Juguemos!! ${user.toUpperCase()}.`);
        instructions();
    }
}

const instructions = () => {//INSTRUCCIONES
    alert (`Lea atentamente la INFORMACIÃ“N DEL JUEGO:\n\nComenzarÃ¡ con 100 puntos y a medida que salgan bolas se le restarÃ¡n 2 puntos en el caso de que el nÂº de bola no coincida con ningÃºn numero de su cartÃ³n,\n\nLa "LINEA", (fila de 10 numeros tachada), otorga 5 puntos, y el "BINGO", (carton tachado en su totalidad) 20 puntos, al finalizar podrÃ¡ ver su puntuaciÃ³n en el ranking.`)
    moreCardBoard();
};





////////////////////////////////////////////////////////////////////////////////////////////////////////


const generateCard = () => {//ESTA FUNCIÃ“N ES PARA QUE ME GENERE EL CARTON Y "EN FILAS DE 5 NUMEROS" Y SIN REPETIRSE LOS NUMEROS.

    const cardBoarLines = [];
    while (noRepeatNumbers.length < 15) {
        const numberCardBoard = Math.floor(Math.random() * (max - min + 1)) + min;
        if (!noRepeatNumbers.includes(numberCardBoard)) {
            noRepeatNumbers.push(numberCardBoard);
        }
    }

    for (let i = 0; i < noRepeatNumbers.length; i++) {
        line += saveNumbers[i] ? 'â­' : noRepeatNumbers[i];
        if ((i + 1) % 5 !== 0) {
            line += ' '; // ESTA LINEA ES PARA AGREGAR UN ESPACIO DESPUES DE CADA NUMERO O ESTRELLA
        }

        if ((i + 1) % 5 === 0 || i === noRepeatNumbers.length - 1) {//AGREGA LAS LINEAS PARA FORMAR EL CARTON
            cardBoarLines.push(line);
            line = "";
        }
    }

    console.log("\nCartÃ³n generado:");
    console.log(cardBoarLines.join('\n')); // PARA VISUALIZAR LA INFORMACION DEL CARTON Y JUGADOR EN LA CONSOLA CON LINEAS SEPARADAS
    console.log(`---Comienza con ${points}---`);
    console.log(cardBoarLines.join('\n'));
}
generateCard();




const moreCardBoard = () => {////ESTA FUNCIÃ“N ES PARA GENERAR NUEVOS CARTONES Y QUE SE VISUALICE AL USUARIO EL MAXIMO DE CARTONES QUE SE PUEDEN GENERAR Y LOS QUE LE QUEDAN
    if (changeCardBoard < infoNumberCardBoard) {
        changeCardBoard++;
        let infoUserCardBoardTotal = infoNumberCardBoard - changeCardBoard;

        if (infoUserCardBoardTotal === 0) {
            alert(`Ya no puede generar ningÃºn cartÃ³n mÃ¡s. Se quedarÃ¡ con el Ãºltimo cartÃ³n generado.`);
            console.log(``);
        } else {
            const confirmation = confirm(`â€¢ "Click" en (Aceptar) para generar mÃ¡s cartones.\nâ€¢ "Click" en (Cancelar) si desea quedarse con el cartÃ³n generado.\n\nPuede cambiarlo --> (${infoUserCardBoardTotal}) <-- veces mÃ¡s.`);
            
            if (confirmation) {
                saveNumbers.length = 0;
                noRepeatNumbers.length = 0;
                generateCard();
                moreCardBoard();
            }
        }
    } else {
        console.log(`Has alcanzado el mÃ¡ximo de 5 cambios de cartÃ³n.`);
    }
    
    balls();
};







const replaceNumberCard = (index) => {//SUSTITUIR POR â­
    saveNumbers[index] = 'â­';
};







const totalUserPoints = () => {//PUNTUACION PARA EL USUARIO
    if (!noRepeatNumbers.includes(noRepeatBall[noRepeatBall.length - 1])) {
        userPoints -= 1;
        console.log(`${userPoints} puntos extra!!`);
    }
}





const playAgain = () => {//FUNCION PARA EL FUNCIONAMIENTO DEL JUEGO

        alert (`JUGUEMOS!!...`)

        points = 100;
        changeCardBoard = 0;
        userPoints = 0;
        completedLines.fill(0);//ESTE METODO LO QUE HACE ES REEMPLAZAR EL ARRAY POR EL "0" PARA QUE EL USUARIO COMIENCE CON TODO RESETEADO Y LA SINTAXIS ES ESTA////..fill(valor, inicio, final);////
        noRepeatBall.length = 0;
        saveNumbers.length = 0;
        noRepeatNumbers.length = 0;

        const newUser = prompt(`Bienvenido al ðŸŽ²BINGO ISDI CODERS!!ðŸŽ²\nCUAL VA A SER SU NOMBRE EN EL JUEGO??`);
        if (newUser === "") {
            alert(`Introduzca un nombre correctamente.`);
            playAgain();
        } else if (newUser === null) {
            alert(`Hasta pronto desconocido...`);
            return;
        } else {
            user = newUser;
            alert(`Juguemos!! ${user.toUpperCase()}.`);
            generateCard();
            moreCardBoard();
            balls();
        }



};








const checkLineBingo = () => {//CANTAR LINEA Y BINGO
    for (let i = 0; i < saveNumbers.length; i += 5) {
        if (saveNumbers[i] && saveNumbers[i + 1] && saveNumbers[i + 2] && saveNumbers[i + 3] && saveNumbers[i + 4]) {
            userPoints += 10;
            console.log(`LINEA!! PUNTOS EXTRA!!`);

            completedLines[Math.floor(i / 5)]++;
        }
    }

    if (completedLines[0] >= 1 && completedLines[1] >= 1 && completedLines[2] >= 1) {
        userPoints += 20;
        console.log(`BINGO!! EL TOTAL DE PUNTOS ACUMULADOS ES:---${userPoints}---`);

        ranking.push({ user, points: userPoints }); // Agregar los datos del jugador al ranking
        
        console.log(`Ranking de Jugadores:`);
        for (let i = 0; i < ranking.length; i++) {
            console.log(`${i + 1}. ${ranking[i].user} â€¢â€¢${ranking[i].points}â€¢â€¢ puntos`);
        }

        let exit = prompt (`Quiere volver a jugar?? Escribe "SI" para empezar un nuevo BINGO, o, "NO" para salir del juego.`)

        switch (exit){
    
            case "SI":
                playAgain();
                break;

            case "NO":
                exitBingo();
                break;

    
            default:
                alert (`Escriba "SI" o "NO"`)
                break;
        }
    }
};




const exitBingo = () => {
    alert (`gracias por jugar`)
}









const balls = () => {//GENERAR BOLAS ALEATORIAS SIN QUE SE REPITA
    alert(`El bombo estÃ¡ dando vueltas...presione aceptar para ver cuÃ¡l es la bola que ha salido al azar...`);

    const minBall = 1;
    const maxBall = 50;

    while (noRepeatBall.length < maxBall) {
        const numberBall = Math.floor(Math.random() * (maxBall - minBall + 1)) + minBall;
        if (!noRepeatBall.includes(numberBall)) {
            noRepeatBall.push(numberBall);
            alert(`EstÃ¡n saliendo las bolas-->(NÂº:${numberBall})<-- \nPresione (Aceptar) para visualizar la marca en el cartÃ³n de la consola y o sacar nueva bola.`);
            const indexOnCard = noRepeatNumbers.indexOf(numberBall);
            if (indexOnCard !== -1) {
                if (!saveNumbers[indexOnCard]) {
                    saveNumbers[indexOnCard] = 'â­';
                    generateCard();
                    checkLineBingo();
                }
            }
        }
    }

    totalUserPoints();

    console.log(`Ranking de Jugadores:`);
    for (let i = 0; i < ranking.length; i++) {
        console.log(`${i + 1}. ${ranking[i].user} â€¢â€¢${ranking[i].points}â€¢â€¢ puntos`);
    }
};




welcome();

